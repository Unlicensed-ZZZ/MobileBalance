<!--
 *
 * Проект:    MobileBalance
 * Описание:  Подготовка файла истории запросов программы MobileBalance для импорта в расширение
 * Редакция:  2022.03.25
 *
-->

При переходе с автономной проприетарной программы MobileBalance возможно сохранить собранную в ней
историю запросов и пополнять её далее результатами опросов расширения. Для этого требуется однократно
подготовить файл истории запросов вручную по инструкции ниже. После разового импорта этих данных в базу
расширения следует проводить дальнейшие сохранение и загрузку истории запросов его штатными средствами.

Подготовленный для импорта файл больше использовать не следует. После первичного импорта данных из этого
файла, его возможно будет лучше удалить, чтобы не запутаться в экземплярах сохранённых данных.

После успешного импорта истории запросов из подготовленного вами файла можно сразу провести сохранение
в файл средствами расширения. Вы получите в нём тот же состав записей истории запросов, которые были успешно
импортированы в расширение, но в актуальном формате его структуры данных. Этот файл далее и следует хранить
в безопасном месте. Рекомендую периодически (раз в месяц?) актуализировать его.

Из 45 полей исходной структуры данных автономной программы MobileBalance (файл BalanceHistory.mdb в
формате Microsoft Access) в структуре данных расширения сохранено 19 полей, актуальных для его работы.
Размер базы данных расширения (и .csv-файлов сохраняемых копий) существенно уменьшился по сравнению с
размером .mdb-файла. Поэтому мои опасения по поводу того, будет ли достаточно допустимой ёмкости структур
хранения браузера (indextdDB) для исторических и вновь поступающих данных опросов оказались напрасными.

Ошибки при импорте данных возможны - учесть полностью все необходимые действия для подготовки данных к
безошибочной загрузке не видится реальным. Тем не менее, в подавляющем большинстве случаев подготовленные
по этой инструкции данные должны пройти проверочные процедуры при экспорте в расширение без сбоев.
Проверить это несложно - в файлах, подготовленном вами для загрузки и сохраненном из расширения после
экспорта, должно быть одинаковое количество строк. Если строк в сохранённом файле меньше - значит какие-то
из записей не прошли проверку и не были импортированы. В этом случае можно обратиться ко мне с подготовленным
для импорта файлом - я постараюсь найти причины и добавлю в инструкцию недостающие действия для их устранения.


-------------------------------------------------------------------------------------------------------------
В последовательности действий, описываемых ниже в инструкции:
 -> это цепочки действий в меню и формах приложений,
 = значения для полей (указанных перед знаком равенства)
-------------------------------------------------------------------------------------------------------------

1.   Microsoft Excel:
1.1. Главное меню: Файл -> Открыть -> Тип файла = Все файлы (*.*) -> BalanceHistory.mdb -> Открыть
1.2. В ответ на сообщение (если появится) системы безопасности Excel "...обнаружил возможное нарушение
     безопасности..." -> Включить
1.3. Форма "Импорт данных" -> Способ представления... = Таблица -> Куда поместить... = Имеющийся лист-> Ok
1.4. В полученной после импорта данных таблице выделить все значения в колонке "QueryDateTime" (колонка B),
     исключая сам заголовок "QueryDateTime"
1.5. Главное меню: Главная -> блок Ячейки -> Формат -> Формат ячеек... -> в открывшейся форме: Число ->
     Числовые форматы = (все форматы) -> Тип = <ГГГГ-ММ-ДДTчч:мм:сс> (скопировать то, что угловых скобках <>.
     Если вписываете вручную, то T - латинская, остальное - кириллица) -> Ok
1.6. Главное меню: Файл -> Сохранить как -> Тип файла = CSV (разделители - запятые) -> Имя файла ->
     BalanceHistory.csv (можете указать любое имя, расширение - строго .csv) -> Сохранить -> Запрос "...Вы
     хотите использовать этот формат?" -> Да
1.7. Закрыть Microsoft Excel. Если появится запрос на сохранение изменений в только что созданном файле ->
     Не сохранять

-------------------------------------------------------------------------------------------------------------

2.   Блокнот (Notepad)
2.1. Главное меню: Файл -> Открыть -> Тип файла = Все файлы (*.*) -> BalanceHistory.csv (или с другим именем,
     с которым файл .csv был сохранён в Excel) -> Открыть

  Следующие операции замены выполняйте в предложенной последовательности, если форма "Заменить" после операции
  не закрылась (не должна) - можно продолжать следующую инструкцию с внесения значения в поле "Что":

2.2. Форма "Правка" -> Заменить... -> Что = <&mdash;> (здесь и далее - вставить то, что внутри угловых
     скобок <>) -> Чем = <-> -> Заменить все
2.3. Форма "Правка" -> Заменить... -> Что = <&nbsp;> -> Чем = < > (один пробел) -> Заменить все
2.4. Форма "Правка" -> Заменить... -> Что = <;";> -> Чем = <;> -> Заменить все
2.5. Форма "Правка" -> Заменить... -> Что = <"> -> Чем = <> (должно быть пусто) -> Заменить все
2.6. Excel считает номера телефонов целочисленными значениями. Поэтому у номеров телефонов, которые
     начинаются с '0', он эти лидирующие нули удаляет. Получается, например, '0501234567' -> '501234567'.
     Если у вас есть такие номера, то их написание следует восстановить. Для этого (на этом же примере):
     Форма "Правка" -> Заменить... -> Что = <501234567> -> Чем = <0501234567> -> Заменить все
2.7. Главное меню: Файл -> Сохранить как -> Кодировка = UTF-8 -> Сохранить -> Запрос "...уже существует,
     заменить?" -> Да
2.8. Закрыть Блокнот (Notepad)

-------------------------------------------------------------------------------------------------------------

     До загрузки полученный файл целесообразно "почистить" от уже ненужной информации. Например, истории по
     учётным данным телефонов, которых у вас уже нет на контроле. Для этого файл, полученный после операций
     в Блокноте, можно повторно открыть, например, в Microsoft Excel, выделить в нём первую строку и включить
     для неё фильтр: Главное меню: Данные -> Сортировка и фильтр -> Фильтр
     В поле выбора появившемся фильтра по стлбцу 'PhoneNumber' можно поочерёдно выбрать уже не нужные вам
     учётные данные (снять пометку 'Выделить все', установить её только для одной позиции учётных данных,
     нажать кнопку 'Ok' в форме). Отфильтрованные строки выделить и удалить. После завершения всех этих
     действий по очистке истории выделить все строки таблицы кроме первой (с заголовками столбцов) и выбрать
     Главное меню: Данные -> Сортировка и фильтр -> Сортировка. В появившейся форме выберите в поле критерия
     сортировки 'Столбец' значение 'NN', остальные оставьте как есть ('Сортировка' -> 'Значения', 'Порядок' ->
     'По возрастанию'). После нажатия кнопки 'Ok' строки будут отсортированы так, что пустые, значения которых
     вы удалили в ходе очистки, окажутся внизу списка. Сохраните (можно в файл с другим именем) полученный
     результат и откройте этот файл в Блокноте (Notepad). Пролистайте все строки, содержащие значения до
     появления строк с пустыми результатами (они будут выгля деть, как коследовательность запятых), выделите
     эти пустые строки до конца фалла, удалите их и сохраните файл.
     В результате в нём останутся только данные истори запросов по тем учётным данным, которые вы предполагаете
     и далее контролировать в MobileBalance. Если такую очистку не провести, то все данные будут загружены, но
     часть из них окажется мёртвым грузом. Они просто будут занимать место в базе MobileBalance, а для того,
     их увидеть будет нужно создать (фейковую) учётную запись с соответствующим номером телефона. Сомнительно,
     что это будет востребовано. Но решать, конечно, вам.

-------------------------------------------------------------------------------------------------------------

3.   В браузере вызвать окно настроек расширения MobileBalance. Например, (для Chrome и Yandex browser) щелчок
     правой кнопки мыши на значке расширения -> в контекстном меню: Настройки -> вкладка "Общие настройки" ->
     группа органов управления "История запросов" -> Загрузить  -> Файл -> BalanceHistory.csv (или с другим
     именем, с которым был создан файл) -> Открыть -> Дождаться завершения загрузки (текущее количество
     записей должно увеличиться)

-------------------------------------------------------------------------------------------------------------
